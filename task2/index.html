<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h1>Task2</h1>
  </body>
  <script>
    const template = "My name is ${name}, age ${age}, I am a ${job.name}";
    const employee = {
      name: "fatfish",
      age: 100,
      job: {
        name: "front end development",
      },
    };

    //not generic code
    // String.prototype.render = function (obj) {
    //   let ans = this.replace("${name}", obj.name)
    //     .replace("${age}", obj.age)
    //     .replace("${job.name}", obj.job.name);
    //   return ans;
    // };

    //generic code
    String.prototype.render = function (obj) {
      let str = this;
      let objectArray = findAllObjectStrings(str);
      objectArray.forEach((prop, index) => {
        let toReplace = "${" + prop + "}";
        let withReplace = replaceWith(prop.split("."), obj);
        str = str.replace(toReplace, withReplace);
      });
      return str;
    };

    function replaceWith(prop, obj) {
      let ans = obj;
      prop.forEach((ele) => {
        ans = ans[ele];
      });
      return ans;
    }
    function findAllObjectStrings(stringValue) {
      let arr = [];
      let brace = false;
      let complete = false;
      let str = "";
      Object.keys(stringValue).forEach((key) => {
        let nextKey = parseInt(key) + 1;
        if (stringValue[nextKey] == "}") {
          brace = false;
          complete = true;
        }
        if (brace) {
          str += stringValue[nextKey];
        }
        if (stringValue[key] == "$" && stringValue[nextKey] == "{") {
          brace = true;
        }
        if (complete) {
          arr.push(str);
          str = "";
          complete = false;
        }
      });
      return arr;
    }

    const renderStr = template.render(employee);
    // What is the output string?
    console.log(renderStr); // 'My name is fatfish, age 100, I am a front end development'
  </script>
</html>
